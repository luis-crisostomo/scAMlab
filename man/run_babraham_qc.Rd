% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_babraham_qc.r
\name{run_babraham_qc}
\alias{run_babraham_qc}
\title{Calculate Comprehensive QC Metrics for Single-Cell RNA-seq Data}
\usage{
run_babraham_qc(
  seurat_obj,
  assay = "RNA",
  max_memory_gb = NULL,
  chunk_size = 1000,
  exclude_genes = NULL,
  mt.fraction = "^mt-|^MT-",
  rb.fraction = "^Rp[sl]|^RP[SL]",
  BPPARAM = NULL
)
}
\arguments{
\item{seurat_obj}{A Seurat object or a list of Seurat objects}

\item{assay}{Character string. Name of the assay to use for QC calculations.
Default: "RNA"}

\item{max_memory_gb}{Numeric or NULL. Maximum memory usage threshold in GB.
If specified, the function will stop if memory usage exceeds this limit.
Default: NULL (no limit)}

\item{chunk_size}{Integer. Number of cells to process in each chunk for
memory-efficient computation of the largest gene per cell. Default: 1000}

\item{exclude_genes}{Character vector or NULL. Gene names or patterns to
exclude from largest gene calculations (e.g., mitochondrial or ribosomal
genes). Default: NULL (no exclusions)}

\item{mt.fraction}{Character string. Either a regex pattern to identify
mitochondrial genes (e.g., "^mt-|^MT-") or a character vector of
mitochondrial gene names. Default: "^mt-|^MT-"}

\item{rb.fraction}{Character string. Either a regex pattern to identify
ribosomal genes (e.g., "^Rp[sl]|^RP[SL]") or a character vector of
ribosomal gene names. Default: "^Rp[sl]|^RP[SL]"}

\item{BPPARAM}{BiocParallelParam object for parallel processing when
computing the largest gene per cell (e.g., MulticoreParam, SnowParam).
If NULL, uses SerialParam for sequential processing. Default: NULL}
}
\value{
\itemize{
\item For single Seurat object: Returns the Seurat object with added QC
metrics in the metadata
\item For list of Seurat objects: Returns a named list of Seurat objects,
each with added QC metrics
}
}
\description{
Computes quality control metrics combining standard Seurat tutorial metrics
with additional QC measures recommended by the Babraham Institute. Supports
both single Seurat objects and lists of Seurat objects with optional parallel
processing and memory management.
}
\details{
This function calculates QC metrics from two established workflows:

\strong{Standard Seurat Tutorial Metrics}
(https://satijalab.org/seurat/articles/pbmc3k_tutorial.html):
\itemize{
\item nCount_RNA: Total UMI counts per cell
\item nFeature_RNA: Number of genes detected per cell
\item percent.mt: Percentage of mitochondrial gene expression
}

\strong{Babraham Institute Additional Metrics}
(https://www.bioinformatics.babraham.ac.uk/training/10XRNASeq/seurat_workflow.html):
\itemize{
\item log10GenesPerUMI: Novelty score (log10(nFeature) / log10(nCount))
\item percent.rb: Percentage of ribosomal gene expression
\item largest_gene: Gene with highest expression in each cell
\item percent.Largest.Gene: Percentage of counts from the largest gene
\item novelty_diff: Deviation from expected log10(genes) based on
log10(UMIs), calculated as residuals from linear regression
}
}
\section{Gene Pattern Matching}{

The function accepts flexible input for mitochondrial and ribosomal genes:
\itemize{
\item \strong{Regex patterns} (detected by presence of regex special characters):
Uses pattern matching to identify genes
\item \strong{Gene name vectors}: Directly uses provided gene names
}

Common patterns:
\itemize{
\item Mouse mitochondrial: "^mt-" or "^Mt-"
\item Human mitochondrial: "^MT-"
\item Ribosomal proteins: "^Rp[sl]" (mouse) or "^RP[SL]" (human)
}
}

\section{Memory Management}{

The function implements several memory optimization strategies:
\itemize{
\item \strong{Chunked processing}: Cells are processed in batches to manage memory
\item \strong{Memory monitoring}: Optional memory limit enforcement
\item \strong{Garbage collection}: Periodic cleanup during computation
\item \strong{Parallel processing}: Distributes memory load across workers
}
}

\section{Novelty Score}{

The novelty_diff metric identifies cells with unusual gene detection rates:
\itemize{
\item Fits a linear model: log10(nFeature) ~ log10(nCount)
\item Calculates residuals as novelty_diff
\item Positive values: more genes than expected (good complexity)
\item Negative values: fewer genes than expected (potential low-quality cells)
\item The fitted linear model is stored in seurat_obj@tools$novelty.lm
}
}

\section{Parallel Processing}{

When calculating the largest gene per cell across many cells, parallel
processing can significantly speed up computation:
\preformatted{
library(BiocParallel)
# For Unix-like systems (Linux, macOS)
param <- MulticoreParam(workers = 4)

# For Windows
param <- SnowParam(workers = 4, type = "SOCK")
}
}

\examples{
\dontrun{
# Basic usage with default parameters
seurat_obj <- run_babraham_qc(seurat_obj)

# Custom mitochondrial and ribosomal patterns for human data
seurat_obj <- run_babraham_qc(
  seurat_obj = seurat_obj,
  mt.fraction = "^MT-",
  rb.fraction = "^RP\[SL\]"
)

# Exclude mitochondrial and ribosomal genes from largest gene calculation
seurat_obj <- run_babraham_qc(
  seurat_obj = seurat_obj,
  exclude_genes = c("^mt-", "^Mt-", "^Rp\[sl\]", "^RP\[SL\]")
)

# Process with memory limit and parallel processing
library(BiocParallel)
param <- MulticoreParam(workers = 4)
seurat_obj <- run_babraham_qc(
  seurat_obj = seurat_obj,
  max_memory_gb = 32,
  chunk_size = 500,
  BPPARAM = param
)

# Process multiple samples
seurat_list <- list(
  Control = seurat_ctrl,
  Treatment = seurat_trt
)

processed_list <- run_babraham_qc(
  seurat_obj = seurat_list,
  BPPARAM = MulticoreParam(workers = 4)
)

# Use specific gene lists instead of patterns
mt_genes <- c("mt-Nd1", "mt-Nd2", "mt-Co1", "mt-Co2", "mt-Atp6")
rb_genes <- c("Rpl3", "Rpl4", "Rps3", "Rps4")

seurat_obj <- run_babraham_qc(
  seurat_obj = seurat_obj,
  mt.fraction = mt_genes,
  rb.fraction = rb_genes
)
}

}
\references{
Seurat PBMC Tutorial: https://satijalab.org/seurat/articles/pbmc3k_tutorial.html

Babraham Institute scRNA-seq Course:
https://www.bioinformatics.babraham.ac.uk/training/10XRNASeq/seurat_workflow.html
}
\seealso{
\code{\link{plot_QC_classic}} for visualizing basic QC metrics
\code{\link{plot_QC_UMAP}} for UMAP-based QC visualizations
\code{\link[BiocParallel]{BiocParallelParam}} for parallel processing options
}
