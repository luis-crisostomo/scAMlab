% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/lowpass_gene_filter.r
\name{lowpass_gene_filter}
\alias{lowpass_gene_filter}
\title{Low-Pass Gene and Cell Filtering for Single-Cell RNA-seq Data}
\usage{
lowpass_gene_filter(
  seurat.obj,
  assay = "RNA",
  min_cells = 0,
  min_transcripts = 1,
  min_cell_transcripts = 0,
  verbose = TRUE
)
}
\arguments{
\item{seurat.obj}{A Seurat object or a list of Seurat objects to be filtered}

\item{assay}{Character string. Name of the assay to use for filtering.
Default: "RNA"}

\item{min_cells}{Integer. Minimum number of cells in which a gene must be
expressed (count > 0) to be retained. Genes expressed in fewer cells are
removed. Default: 0 (no filtering based on cell count)}

\item{min_transcripts}{Integer. Minimum total transcript count across all
cells for a gene to be retained. Genes with fewer total transcripts are
removed. Default: 1 (removes genes with zero counts)}

\item{min_cell_transcripts}{Integer. Minimum total transcript count per cell
after gene filtering. Cells with fewer transcripts are removed in the
second filtering step. Set to 0 to skip cell filtering. Default: 0 (no
cell filtering)}

\item{verbose}{Logical. If TRUE, prints detailed filtering statistics for
each object. Default: TRUE}
}
\value{
\itemize{
\item For single Seurat object: Returns a filtered Seurat object
\item For list of Seurat objects: Returns a named list of filtered Seurat
objects with the same names as the input list
}
}
\description{
Performs quality-based filtering on single-cell RNA-seq data by removing
low-expressed genes and optionally low-quality cells. Implements a two-step
filtering process: first removes genes based on expression criteria, then
optionally removes cells with insufficient transcripts after gene filtering.
Supports both single Seurat objects and lists of Seurat objects.
}
\details{
\strong{Filtering Process:}

The function implements a two-step filtering approach:

\strong{Step 1: Gene Filtering}

Genes are removed if they fail EITHER of these criteria:
\itemize{
\item Expressed in fewer than \code{min_cells} cells (count > 0)
\item Have fewer than \code{min_transcripts} total counts across all cells
}

Both thresholds must be met for a gene to be retained. This dual-threshold
approach helps remove both:
\itemize{
\item Sparsely expressed genes (expressed in very few cells)
\item Very lowly expressed genes (low total counts even if in many cells)
}

\strong{Step 2: Cell Filtering (optional)}

After gene filtering, if \code{min_cell_transcripts > 0}, cells are removed
if they have fewer than \code{min_cell_transcripts} total counts in the
filtered gene set. This step is important because:
\itemize{
\item Gene filtering may reduce some cells' transcript counts substantially
\item Cells that fall below the threshold after gene filtering are likely
low-quality or empty droplets
}
}
\note{
\itemize{
\item This function modifies the Seurat object by subsetting features and
cells. Other data (e.g., reductions, graphs) may need to be
recalculated after filtering.
\item The order of filtering (genes first, then cells) is intentional.
Cell filtering based on post-gene-filtering transcript counts helps
identify cells that were mainly expressing filtered genes.
\item For very large datasets, consider filtering genes first with
min_cells only, then examining cell quality separately.
}
}
\section{Verbose Output}{

When \code{verbose = TRUE}, the function prints detailed statistics:

\strong{Gene Filtering Statistics:}
\itemize{
\item Total genes in original object
\item Genes expressed in < min_cells cells
\item Genes with < min_transcripts total transcripts
\item Breakdown of genes removed by each criterion
\item Percentage of genes removed
\item List of removed genes (up to 10)
}

\strong{Cell Filtering Statistics (if applicable):}
\itemize{
\item Total cells before filtering
\item Cells with < min_cell_transcripts
\item Percentage of cells removed
\item Transcript count range in removed cells
}
}

\section{Threshold Guidelines}{

Recommended starting thresholds depend on your data and experimental design:

\strong{Conservative filtering (retain more features):}
\itemize{
\item min_cells = 3-5
\item min_transcripts = 5-10
\item min_cell_transcripts = 200-500
}

\strong{Moderate filtering (standard QC):}
\itemize{
\item min_cells = 5-10
\item min_transcripts = 10-20
\item min_cell_transcripts = 500-1000
}

\strong{Stringent filtering (high-quality cells only):}
\itemize{
\item min_cells = 10-20
\item min_transcripts = 20-50
\item min_cell_transcripts = 1000-2000
}

Note: Optimal thresholds vary by tissue type, sequencing depth, and
biological context. Examine QC plots before and after filtering.
}

\section{Safety Features}{

The function includes safety checks to prevent data loss:
\itemize{
\item If all genes would be removed, returns original object with a warning
\item If all cells would be removed, skips cell filtering with a warning
\item Validates that assay exists before filtering
\item Checks for empty count matrices
}
}

\section{Processing Multiple Objects}{

When processing a list of Seurat objects:
\itemize{
\item Each object is filtered independently with the same thresholds
\item Statistics are printed separately for each object (if verbose = TRUE)
\item Original list names are preserved in the output
\item If input list is unnamed, objects are named "Object_1", "Object_2", etc.
}
}

\examples{
\dontrun{
# Basic gene filtering: remove genes in < 3 cells
filtered_seurat <- lowpass_gene_filter(
  seurat.obj = seurat_obj,
  min_cells = 3
)

# Filter genes AND cells
filtered_seurat <- lowpass_gene_filter(
  seurat.obj = seurat_obj,
  min_cells = 5,
  min_transcripts = 10,
  min_cell_transcripts = 500
)

# Conservative filtering (retain more features)
filtered_seurat <- lowpass_gene_filter(
  seurat.obj = seurat_obj,
  min_cells = 3,
  min_transcripts = 5,
  min_cell_transcripts = 200
)

# Stringent filtering (high-quality cells only)
filtered_seurat <- lowpass_gene_filter(
  seurat.obj = seurat_obj,
  min_cells = 20,
  min_transcripts = 50,
  min_cell_transcripts = 2000
)

# Silent filtering (no verbose output)
filtered_seurat <- lowpass_gene_filter(
  seurat.obj = seurat_obj,
  min_cells = 10,
  min_transcripts = 20,
  verbose = FALSE
)

# Process multiple samples
seurat_list <- list(
  Control = seurat_ctrl,
  Treatment1 = seurat_trt1,
  Treatment2 = seurat_trt2
)

filtered_list <- lowpass_gene_filter(
  seurat.obj = seurat_list,
  min_cells = 5,
  min_transcripts = 10,
  min_cell_transcripts = 500
)

# Access individual filtered objects
filtered_ctrl <- filtered_list$Control

# Use different assay
filtered_seurat <- lowpass_gene_filter(
  seurat.obj = seurat_obj,
  assay = "SCT",
  min_cells = 5
)

# Gene filtering only (no cell filtering)
filtered_seurat <- lowpass_gene_filter(
  seurat.obj = seurat_obj,
  min_cells = 10,
  min_transcripts = 20,
  min_cell_transcripts = 0  # Skip cell filtering
)
}

}
\seealso{
\code{\link[Seurat]{subset}} for the underlying subsetting operation
\code{\link{run_babraham_qc}} for computing QC metrics before filtering
\code{\link{plot_QC_classic}} for visualizing QC metrics
}
