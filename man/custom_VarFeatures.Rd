% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/custom_VarFeatures.r
\name{custom_VarFeatures}
\alias{custom_VarFeatures}
\title{Data-Driven Variable Feature Selection for Single-Cell RNA-seq}
\usage{
custom_VarFeatures(
  seurat_obj,
  method = c(1, 3),
  method_params = list(),
  plot = TRUE,
  save_plot = FALSE,
  plot_filename = "QC_varFeatures",
  ...
)
}
\arguments{
\item{seurat_obj}{A Seurat object containing single-cell RNA-seq data}

\item{method}{Integer vector specifying which method(s) to use. Options are:
\itemize{
\item 1: Elbow method on cumulative variance explained
\item 2: Inflection point detection in variance distribution
\item 3: Standardized Variance threshold on standardized variance
\item 4: PCA-based feature selection with inflection point detection
}
Can be a single value (e.g., 3) or multiple values (e.g., c(1, 3)).
Default: c(1, 3)}

\item{method_params}{Named list of parameters for each method. Each element
should be named "method1", "method2", "method3", or "method4" and contain
a list of method-specific parameters. See Details for available parameters.
Default: list() (uses default parameters for all methods)}

\item{plot}{Logical. If TRUE, displays diagnostic plots for each method.
Default: TRUE}

\item{save_plot}{Logical. If TRUE, saves the diagnostic plots as a TIFF file.
Default: FALSE}

\item{plot_filename}{Character string. Base name for the saved plot file
(will be converted to .tiff format). Default: "QC_varFeatures"}

\item{...}{Additional arguments passed to \code{\link[Seurat]{NormalizeData}}}
}
\value{
A list containing results for each method used, with the following structure:
\itemize{
\item \strong{methodX}: Results for each method, containing:
\itemize{
\item features: Character vector of selected feature names
\item n_features: Number of features selected
\item Method-specific metrics (see Details)
\item parameters: Parameters used for this method
}
\item \strong{comparison}: (if multiple methods used) Comparison between methods:
\itemize{
\item common_features: Features selected by all methods
\item method-specific differences
}
\item \strong{parameters}: Overall metadata about methods and parameters used
\item \strong{plot_function}: Function to regenerate plots (if plot=TRUE)
\item \strong{plot_dimensions}: Dimensions used for plots
}
}
\description{
Implements four different data-driven methods for selecting highly variable
features (HVFs) in single-cell RNA-seq data. Each method provides an
alternative approach to the standard Seurat variable feature selection,
allowing users to choose features based on variance explained, inflection
points, statistical thresholds, or PCA loadings. The function supports
multiple methods simultaneously for comparison.
}
\details{
\strong{Method 1: Elbow Method on Cumulative Variance}

Selects features based on cumulative variance explained, similar to choosing
principal components in PCA. Features are ranked by standardized variance,
and selection stops when cumulative variance reaches a threshold.

Parameters (method_params$method1):
\itemize{
\item max_features: Maximum number of features to consider (default: 8000)
\item cumvar_threshold: Cumulative variance threshold (default: 0.8, i.e., 80\%)
}

\strong{Method 2: Inflection Point in Variance Distribution}

Identifies natural breakpoints in the variance distribution curve using
inflection point detection. This finds where the variance curve changes
curvature, indicating a transition between highly variable and less variable
genes. Multiple inflection points may be detected, requiring user selection
via interactive prompt.

Parameters (method_params$method2):
\itemize{
\item max_features: Maximum number of features to consider (default: 8000)
}

Note: Requires the \code{inflection} package. User will be prompted to
select among detected inflection points.

\strong{Method 3: Standardized Variance Threshold}

Selects features where standardized variance exceeds a fixed threshold.
This is the most straightforward approach, selecting all genes that show
variance above background levels.

Parameters (method_params$method3):
\itemize{
\item max_features: Maximum number of features to consider (default: 8000)
\item variance_threshold: Minimum standardized variance (default: 1.3)
}

\strong{Method 4: PCA-Based Feature Selection}

Uses PCA loadings to identify important features. First determines significant
PCs using an elbow plot, then calculates feature importance as the sum of
absolute loadings across these PCs. Inflection points in the feature
importance curve identify optimal cutoffs. Multiple inflection points may
be detected, requiring user selection via interactive prompt.

Parameters (method_params$method4):
\itemize{
\item max_features: Maximum number of features to consider (default: 8000)
\item cumvar_threshold: Cumulative variance threshold for PC selection (default: 0.8)
}

Note: Requires the \code{inflection} package. User will be prompted to
select among detected inflection points.
}
\section{Interactive Selection}{

Methods 2 and 4 use inflection point detection, which may identify multiple
potential cutoffs. When this occurs:
\enumerate{
\item Diagnostic plots are displayed showing all inflection points
\item The function prints information about each inflection point
\item User is prompted to select which inflection point to use
\item Selection is stored in results$methodX$selected_features
}

If only one inflection point is found, it is used automatically.
}

\section{Diagnostic Plots}{

Each method generates diagnostic plots to help interpret results:
\itemize{
\item \strong{Method 1}: Elbow plot showing cumulative variance with threshold line
\item \strong{Method 2}: Variance distribution with inflection points marked
\item \strong{Method 3}: Variance distribution colored by selection threshold
\item \strong{Method 4}: Two plots - PCA elbow plot and feature importance
with inflection points
}

Plots are arranged in a grid layout (1-3 columns depending on number of methods).
When saved, plots are 5Ã—5 inches per panel at 200 DPI in TIFF format.
}

\section{Method Comparison}{

When multiple methods are used, the function automatically compares results:
\itemize{
\item Prints number of features selected by each method
\item Calculates intersection (common features across all methods)
\item For 2 methods: identifies method-specific features
\item Results stored in results$comparison
}
}

\section{Memory Efficiency}{

The function creates a temporary DietSeurat object containing only the RNA
assay to reduce memory usage during computation. The original Seurat object
is not modified.
}

\examples{
\dontrun{
# Basic usage with default methods (1 and 3)
hvf_results <- custom_VarFeatures(seurat_obj)

# Access selected features from Method 1
selected_genes <- hvf_results$method1$features

# Use a single method with custom parameters
hvf_results <- custom_VarFeatures(
  seurat_obj = seurat_obj,
  method = 3,
  method_params = list(
    method3 = list(
      max_features = 5000,
      variance_threshold = 1.5
    )
  )
)

# Compare multiple methods
hvf_results <- custom_VarFeatures(
  seurat_obj = seurat_obj,
  method = c(1, 2, 3, 4),
  plot = TRUE,
  save_plot = TRUE,
  plot_filename = "HVF_comparison"
)

# Check common features across methods
common_genes <- hvf_results$comparison$common_features
cat("Found", length(common_genes), "genes in common\n")

# Use Method 1 with strict variance threshold
hvf_results <- custom_VarFeatures(
  seurat_obj = seurat_obj,
  method = 1,
  method_params = list(
    method1 = list(
      max_features = 10000,
      cumvar_threshold = 0.9  # 90\% variance explained
    )
  )
)

# Use Method 4 (PCA-based) with custom normalization
hvf_results <- custom_VarFeatures(
  seurat_obj = seurat_obj,
  method = 4,
  normalization.method = "LogNormalize",
  scale.factor = 10000
)

# Apply selected features to original Seurat object
VariableFeatures(seurat_obj) <- hvf_results$method1$features
}

}
\references{
Inflection point detection: Christopoulos, D.T. (2016). "Developing methods
for identifying the inflection point of a convex/concave curve." arXiv:1206.5478
}
\seealso{
\code{\link[Seurat]{FindVariableFeatures}} for standard Seurat HVF selection
\code{\link[Seurat]{VariableFeatures}} for setting/getting variable features
}
