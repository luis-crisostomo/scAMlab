% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_QC_babraham.r
\name{plot_QC_babraham}
\alias{plot_QC_babraham}
\title{Generate Babraham Institute QC Plots for Single-Cell RNA-seq Data}
\usage{
plot_QC_babraham(
  seurat.obj,
  large.genes = 100,
  filename = "QC_Babraham",
  ident = "orig.ident",
  feature.thres = 500,
  count.thres = 1000,
  gene.thres = 30,
  mt.thres = 10,
  rb.thres = 5,
  novelty.thres = 0.7,
  novelty.diff.thres = c(-0.2, 0.2),
  assay = "RNA",
  BPPARAM = NULL
)
}
\arguments{
\item{seurat.obj}{A Seurat object or a list of Seurat objects. Each object
should contain QC metrics computed by \code{\link{run_babraham_qc}}.}

\item{large.genes}{Numeric. Minimum number of cells in which a gene must be
the largest expressed gene to be individually colored and labeled in plots.
Genes appearing in fewer cells are grouped as "Other". Default: 100}

\item{filename}{Character string. Base name for the output TIFF file(s)
(without extension). For lists of objects, object names will be appended.
Default: "QC_Babraham"}

\item{ident}{Character string. Name of the metadata column to use for
faceting in dual scatter plots. Default: "orig.ident"}

\item{feature.thres}{Numeric. Threshold for minimum number of genes
(nFeature_RNA) per cell, shown as a dashed horizontal line in dual plots.
Default: 500}

\item{count.thres}{Numeric. Threshold for minimum UMI counts (nCount_RNA)
per cell, shown as a dashed vertical line in dual plots. Default: 1000}

\item{gene.thres}{Numeric. Threshold for maximum percentage of the largest
gene per cell, shown as a dashed horizontal line in the largest gene plot.
Default: 30}

\item{mt.thres}{Numeric. Threshold for maximum mitochondrial percentage,
used for reference (not currently plotted as a line). Default: 10}

\item{rb.thres}{Numeric. Threshold for ribosomal percentage, used for
reference (not currently plotted as a line). Default: 5}

\item{novelty.thres}{Numeric. Threshold for minimum novelty score
(log10GenesPerUMI), shown as a dashed vertical line in the novelty
histogram. Default: 0.7}

\item{novelty.diff.thres}{Numeric vector of length 2. Lower and upper
thresholds for novelty difference (residuals from the novelty linear
model), shown as dashed vertical lines. Default: c(-0.2, 0.2)}

\item{assay}{Character string. Name of the assay to use for plotting
nCount and nFeature. Default: "RNA"}

\item{BPPARAM}{BiocParallelParam object for parallel processing when input
is a list (e.g., MulticoreParam, SnowParam). If NULL, processes
sequentially. Default: NULL}
}
\value{
\itemize{
\item For single Seurat object: Returns a patchwork plot object
\item For list of Seurat objects: Returns a named list of patchwork plot
objects, with names derived from the input list
}
}
\description{
Creates comprehensive quality control visualizations following the Babraham
Institute workflow, including novelty scores, largest gene analysis, and
dual scatter plots with QC metrics overlays. Supports both single Seurat
objects and lists of Seurat objects with optional parallel processing.
}
\details{
The function generates a 3×2 grid layout (6 panels) for each sample:

\strong{Row 1 (3 panels):}
\itemize{
\item \strong{Novelty Histogram}: Distribution of log10GenesPerUMI across cells,
colored by identity, with threshold line
\item \strong{Novelty Difference Histogram}: Distribution of novelty_diff
(residuals from linear regression), with threshold lines
\item \strong{Largest Gene Scatter}: novelty_diff vs percent.Largest.Gene,
colored by the identity of the largest gene (only genes appearing
as largest in >large.genes cells are shown)
}

\strong{Row 2 (2 panels):}
\itemize{
\item \strong{Novelty QC Dual Plot}: nCount vs nFeature scatter plot with
novelty_diff color gradient and the fitted linear regression line,
faceted by ident
\item \strong{Largest Gene Dual Plot}: nCount vs nFeature scatter plot colored
by largest gene identity, faceted by ident
}

\strong{Row 3 (2 panels):}
\itemize{
\item \strong{MT\% Dual Plot}: nCount vs nFeature scatter plot with
mitochondrial percentage color gradient, faceted by ident
\item \strong{RB\% Dual Plot}: nCount vs nFeature scatter plot with ribosomal
percentage color gradient, faceted by ident
}
}
\section{Required Metadata}{

The Seurat object(s) must contain QC metrics generated by
\code{\link{run_babraham_qc}}:
\itemize{
\item log10GenesPerUMI: Novelty score
\item novelty_diff: Deviation from expected novelty
\item largest_gene: Gene with highest expression per cell
\item percent.Largest.Gene: Percentage of counts from largest gene
\item percent.mt: Mitochondrial percentage
\item percent.rb: Ribosomal percentage
\item nCount_RNA, nFeature_RNA: Standard Seurat metrics
}

Additionally, the linear model for novelty should be stored in
\code{seurat_obj@tools$novelty.lm}.
}

\section{Threshold Guidelines}{

Default thresholds are starting points and should be adjusted based on your
data and biological system:
\itemize{
\item \strong{feature.thres} (500): Cells with fewer genes may be low quality
\item \strong{count.thres} (1000): Cells with fewer UMIs may be low quality
\item \strong{gene.thres} (30): Cells where one gene dominates may be stressed
or damaged
\item \strong{novelty.thres} (0.7): Lower values indicate low complexity
\item \strong{novelty.diff.thres} (±0.2): Large deviations may indicate
technical issues
\item \strong{mt.thres} (10): High mitochondrial content suggests cell stress
\item \strong{rb.thres} (5): High ribosomal content may indicate certain cell
states
}
}

\section{Output Files}{

For each Seurat object, saves a TIFF file with dimensions 18×15 inches at
200 DPI resolution. File naming:
\itemize{
\item Single object: "{filename}.tiff"
\item List objects: "{filename}{name}_QC_Babraham.tiff"
\item Combined plot (≤4 objects): "{filename}_combined.tiff"
}
}

\section{Color Schemes}{

\itemize{
\item \strong{Largest genes}: Uses RColorBrewer Set1 palette with grey for the
most common gene, "Other" in light grey
\item \strong{Novelty difference}: Blue (negative) to grey (zero) to red (positive)
\item \strong{MT\% and RB\%}: Black to blue to green to red to yellow gradient
}
}

\section{Parallel Processing}{

When processing multiple samples, parallel processing can speed up computation:
\preformatted{
library(BiocParallel)
# For Unix-like systems (Linux, macOS)
param <- MulticoreParam(workers = 4)

# For Windows
param <- SnowParam(workers = 4, type = "SOCK")
}
}

\examples{
\dontrun{
# First, compute QC metrics
seurat_obj <- run_babraham_qc(seurat_obj)

# Basic plotting with default parameters
plot_QC_babraham(seurat_obj)

# Custom thresholds for stricter filtering
plot_QC_babraham(
  seurat.obj = seurat_obj,
  filename = "Strict_QC",
  feature.thres = 1000,
  count.thres = 2000,
  gene.thres = 20,
  mt.thres = 5,
  novelty.thres = 0.8,
  novelty.diff.thres = c(-0.1, 0.1)
)

# Plot only highly abundant largest genes
plot_QC_babraham(
  seurat.obj = seurat_obj,
  large.genes = 500,  # Only show genes that are largest in >500 cells
  filename = "Common_genes_QC"
)

# Process multiple samples with parallel processing
library(BiocParallel)
seurat_list <- list(
  Sample1 = seurat_obj1,
  Sample2 = seurat_obj2,
  Sample3 = seurat_obj3
)

# Each object should have QC metrics
seurat_list <- lapply(seurat_list, run_babraham_qc)

# Generate plots in parallel
param <- MulticoreParam(workers = 3)
plots <- plot_QC_babraham(
  seurat.obj = seurat_list,
  filename = "MultiSample_",
  BPPARAM = param
)

# Use different identity for faceting
plot_QC_babraham(
  seurat.obj = seurat_obj,
  ident = "seurat_clusters",  # Facet by cluster instead of orig.ident
  filename = "Cluster_QC"
)
}

}
\references{
Babraham Institute scRNA-seq Course:
https://www.bioinformatics.babraham.ac.uk/training/10XRNASeq/seurat_workflow.html
}
\seealso{
\code{\link{run_babraham_qc}} for computing the required QC metrics
\code{\link{plot_QC_classic}} for classic QC visualizations
\code{\link{plot_QC_UMAP}} for UMAP-based QC visualizations
\code{\link[BiocParallel]{BiocParallelParam}} for parallel processing options
}
