% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/subset_seurat.r
\name{subset_seurat}
\alias{subset_seurat}
\title{Run scDblFinder for Doublet Detection in Single-Cell RNA-seq Data}
\usage{
subset_seurat(
  seurat_obj,
  subset_criteria,
  verbose = TRUE,
  sample = NULL,
  assay = NULL,
  param = NULL
)
}
\arguments{
\item{seurat_obj}{A Seurat object or a list of Seurat objects to process
for doublet detection}

\item{assay}{Character string. Name of the assay to use for doublet detection.
Can be a single value (applied to all objects) or a vector matching the
length of seurat_obj when processing a list. Default: "RNA"}

\item{clusters}{Logical. If TRUE, runs fast clustering before doublet
detection to improve accuracy by identifying cell populations. If FALSE,
performs doublet detection without clustering. Can be a single value
(applied to all objects) or a vector matching the length of seurat_obj
when processing a list. Default: TRUE}

\item{...}{Additional arguments passed to \code{\link[scDblFinder]{scDblFinder}}.
Common arguments include:
\itemize{
\item \strong{dbr}: Expected doublet rate (NULL for automatic estimation)
\item \strong{dbr.sd}: Standard deviation of doublet rate (default: 0.015)
\item \strong{nfeatures}: Number of top features to use (default: 1000)
\item \strong{dims}: Number of PCA dimensions to use (default: 20)
\item \strong{k}: Number of nearest neighbors (default: 10)
\item \strong{BPPARAM}: BiocParallelParam for parallel processing
}
When processing a list, can be single values (applied to all) or vectors/lists
matching the number of objects.}
}
\value{
\itemize{
\item For single Seurat object: Returns the input Seurat object with added
metadata columns:
\itemize{
\item \strong{doublet_scores}: Numeric doublet scores (0-1, higher = more likely doublet)
\item \strong{doublet_class}: Factor classification ("singlet" or "doublet")
\item \strong{fastcluster_clusters}: Factor cluster assignments (if clusters = TRUE)
}
\item For list of Seurat objects: Returns a named list of processed Seurat
objects with the same structure as above
}
}
\description{
Detects doublets (artificial cells formed by two or more cells captured
together) in single-cell RNA-seq data using scDblFinder. The function
converts Seurat objects to SingleCellExperiment format, optionally performs
fast clustering for improved doublet detection, and adds doublet scores and
classifications back to the Seurat object. Supports both single Seurat
objects and lists of Seurat objects with flexible parameter specification.
}
\details{
\strong{Doublet Detection Overview:}

Doublets are a common technical artifact in droplet-based scRNA-seq where
two or more cells are captured in the same droplet, creating artificial
transcriptional profiles. scDblFinder uses:
\enumerate{
\item Simulation of artificial doublets from the data
\item Machine learning to distinguish real doublets from singlets
\item Cluster-aware detection to account for cell type composition
}

\strong{Why Use Clustering?}

Setting \code{clusters = TRUE} (recommended) provides several advantages:
\itemize{
\item \strong{Improved accuracy}: Doublet detection considers cell type composition
\item \strong{Reduced false positives}: Prevents rare cell types from being
flagged as doublets
\item \strong{Better doublet simulation}: Creates more realistic artificial
doublets based on actual cell populations
\item \strong{Cluster information}: Adds fastcluster_clusters to metadata
for QC visualization
}

Set \code{clusters = FALSE} only if:
\itemize{
\item Dataset is very small (< 500 cells)
\item All cells are expected to be from one homogeneous population
\item You want faster processing and already have cluster information
}

\strong{Expected Doublet Rates:}

Typical doublet rates by technology (if dbr not specified, scDblFinder estimates):
\itemize{
\item 10X Chromium: ~1\% per 1,000 cells loaded (e.g., 8\% at 8,000 cells)
\item Drop-seq: ~2\% per 1,000 cells
\item inDrops: ~2\% per 1,000 cells
}

The actual rate depends on cell loading concentration and capture efficiency.

\strong{Processing Multiple Objects:}

When processing a list of Seurat objects, parameters can be specified as:
\itemize{
\item \strong{Single values}: Applied to all objects (e.g., clusters = TRUE)
\item \strong{Vectors}: Different value for each object (e.g., assay = c("RNA", "SCT", "RNA"))
\item \strong{Lists}: For complex parameters like BPPARAM
}

All parameters are validated to ensure correct length matching the number of objects.

\strong{Memory Management:}

The function includes automatic memory management:
\itemize{
\item Garbage collection after conversion to SingleCellExperiment
\item Removal of temporary SCE object after processing
\item Garbage collection between objects when processing lists
}

\strong{Interpreting Results:}

\strong{doublet_scores}:
\itemize{
\item Range: 0 to 1
\item Higher scores indicate higher probability of being a doublet
\item Typical threshold: 0.5 (but examine distribution in your data)
}

\strong{doublet_class}:
\itemize{
\item "singlet": Predicted single cell
\item "doublet": Predicted doublet (typically scores > 0.5)
\item Based on automatic threshold selection by scDblFinder
}
}
\section{Workflow Integration}{

Doublet detection should typically be performed:
\enumerate{
\item After basic QC (gene/cell filtering)
\item Before normalization and integration
\item Before clustering for downstream analysis
}

Recommended workflow:
\preformatted{
# 1. Basic filtering
seurat_obj <- lowpass_gene_filter(seurat_obj, min_cells = 3)

# 2. Doublet detection
seurat_obj <- run_scDblFinder(seurat_obj, clusters = TRUE)

# 3. Visualize doublets
plot_QC_UMAP(seurat_obj)  # Check doublet distribution

# 4. Remove doublets
seurat_obj <- subset(seurat_obj, subset = doublet_class == "singlet")

# 5. Continue with normalization and analysis
}
}

\examples{
\dontrun{
# Basic usage with default parameters
seurat_obj <- run_scDblFinder(seurat_obj)

# Check results
table(seurat_obj$doublet_class)
summary(seurat_obj$doublet_scores)

# Visualize doublet scores
FeaturePlot(seurat_obj, features = "doublet_scores")

# Without clustering (faster but less accurate)
seurat_obj <- run_scDblFinder(seurat_obj, clusters = FALSE)

# Specify expected doublet rate (e.g., 5\%)
seurat_obj <- run_scDblFinder(
  seurat_obj = seurat_obj,
  dbr = 0.05
)

# Use different assay
seurat_obj <- run_scDblFinder(
  seurat_obj = seurat_obj,
  assay = "SCT"
)

# Custom parameters for more sensitive detection
seurat_obj <- run_scDblFinder(
  seurat_obj = seurat_obj,
  nfeatures = 2000,  # Use more features
  dims = 30,         # Use more PCA dimensions
  k = 20             # Use more neighbors
)

# Parallel processing with BiocParallel
library(BiocParallel)
seurat_obj <- run_scDblFinder(
  seurat_obj = seurat_obj,
  BPPARAM = MulticoreParam(workers = 4)
)

# Process multiple samples
seurat_list <- list(
  Sample1 = seurat_obj1,
  Sample2 = seurat_obj2,
  Sample3 = seurat_obj3
)

# Same parameters for all
results <- run_scDblFinder(seurat_list, clusters = TRUE)

# Different parameters for each sample
results <- run_scDblFinder(
  seurat_obj = seurat_list,
  clusters = c(TRUE, TRUE, FALSE),  # No clustering for sample 3
  assay = c("RNA", "RNA", "SCT"),   # Different assay for sample 3
  dbr = c(0.05, 0.08, 0.06)         # Different doublet rates
)

# Remove doublets from all samples
singlets_list <- lapply(results, function(obj) {
  subset(obj, subset = doublet_class == "singlet")
})

# Check doublet rates across samples
doublet_summary <- sapply(results, function(obj) {
  sum(obj$doublet_class == "doublet") / ncol(obj)
})
print(doublet_summary)
}

}
\references{
Germain, P. L., Lun, A., Garcia Meixide, C., Macnair, W., & Robinson, M. D. (2021).
Doublet identification in single-cell sequencing data using scDblFinder.
F1000Research, 10, 979. DOI: https://doi.org/10.12688/f1000research.73600.2

scDblFinder documentation: https://bioconductor.org/packages/scDblFinder/
}
\seealso{
\code{\link[scDblFinder]{scDblFinder}} for the underlying doublet detection algorithm
\code{\link[scDblFinder]{fastcluster}} for fast clustering implementation
\code{\link{plot_QC_UMAP}} for visualizing doublet detection results
\code{\link{run_babraham_qc}} for comprehensive QC before doublet detection
}
